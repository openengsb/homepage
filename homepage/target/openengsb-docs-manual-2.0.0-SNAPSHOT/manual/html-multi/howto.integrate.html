<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;12.&nbsp;HowTo - Integrate services with OpenEngSB</title><link rel="stylesheet" href="css/html.css" type="text/css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.75.2"><link rel="home" href="openengsb-manual.html" title="OpenEngSB Manual"><link rel="up" href="tutorials.manual.html" title="Part&nbsp;II.&nbsp;Tutorials"><link rel="prev" href="howto.composite.html" title="Chapter&nbsp;11.&nbsp;HowTo - Combine mulitple connectors"><link rel="next" href="user.manual.html" title="Part&nbsp;III.&nbsp;OpenEngSB Framework"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div xmlns:fo="http://www.w3.org/1999/XSL/Format" id="top"><div id="header"><div class="projectlogo"></div></div></div><div xmlns:fo="http://www.w3.org/1999/XSL/Format" class="mhSpacer"></div><div class="chapter" title="Chapter&nbsp;12.&nbsp;HowTo - Integrate services with OpenEngSB"><div class="titlepage"><div><div><h2 class="title"><a name="howto.integrate"></a>Chapter&nbsp;12.&nbsp;HowTo - Integrate services with OpenEngSB</h2></div></div></div><div class="section" title="12.1.&nbsp;Goal"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e933"></a>12.1.&nbsp;Goal</h2></div></div></div><p>The service integration tutorial shows how to combine and automate different software tools, services and applications with OpenEngSB. To show OpenEngSB's versatility the use case we will be implementing is a continuous integration (CI) tool for software development processes. The tutorial takes a straight forward approach favoring visible results over architectural details of tool integration. Whether or not you have experience with CI, bear with the tutorial for a moment and you will see how simple it works out.</p><p>Before we get started let us lay out the idea of our CI tool and create a step-by-step development plan. The practice of continuous integration aims at improving software quality by frequent (automated) building and testing of a project's source base and by reporting back to the developers. The CI tool must be able to access the source repository, build the project, test the binaries and  reports to the developers. And there we have a basic four step plan:</p><p>(1) Repository access</p><p>(2) Building source</p><p>(3) Testing binaries</p><p>(4) Notification process</p><p>If you would like to take a look at a fully functional CI server built on OpenEngSB check out <a class="link" href="http://opencit.openengsb.org" target="_top">OpenCIT</a>. It implements a wider range of features, but it's a great reference.</p></div><div class="section" title="12.2.&nbsp;Time to Complete"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e953"></a>12.2.&nbsp;Time to Complete</h2></div></div></div><p>If you are already familiar with the OpenEngSB about 30 minutes. If you are not familiar with the OpenEngSB please read this manual from the start or check the <a class="link" href="http://www.openengsb.org" target="_top">homepage</a> for further information.</p></div><div class="section" title="12.3.&nbsp;Prerequisites"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e961"></a>12.3.&nbsp;Prerequisites</h2></div></div></div><p>It is assumed you have basic knowledge of software development practices and you are able to set up auxiliary software (i.e. JDK 1.6) youself.</p><p>Warning: This section is likely to change in the near future, as the web UI as well as domains and connectors are subject to change.</p></div><div class="section" title="12.4.&nbsp;Setting up OpenEngSB"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e968"></a>12.4.&nbsp;Setting up OpenEngSB</h2></div></div></div><div class="mediaobject" align="center"><img src="graphics/ci_download.png" align="middle"><div class="caption">download openengsb</div></div><p>Getting OpenEngSB is simple. Go to <a class="link" href="http://www.openengsb.org" target="_top">openengsb.org</a>, <a class="link" href="http://www.openengsb.org/downloads.html" target="_top">download</a> the latest stable version to your computer and unpack the archive to a convenient location. Before you fire up OpenEngSB for the first time, please make sure you have a Java Development Kit 1.6+ available and set up.</p><div class="mediaobject" align="center"><img src="graphics/ci_console.png" align="middle"><div class="caption">openengsb console</div></div><p>You can startup OpenEngSB via the <span class="command"><strong>openengsb</strong></span> script in the "bin" folder. If you want to explore the web interface yourself before digging into implementing the CI use case, open up your web browser and navigate to <a class="link" href="http://localhost:8090/openengsb" target="_top">http://localhost:8090/openengsb</a> and log on as "admin" with password "password".</p><div class="mediaobject" align="center"><img src="graphics/ci_webui.png" align="middle"><div class="caption">openengsb web UI</div></div><p>If you want to take a break or shutdown OpenEngSB in the middle of the tutorial, go ahead and do not worry. All changes made so far are saved and restored upon restart, so you can continue working with the most up-to-date state. Use the <span class="command"><strong>shutdown</strong></span> command in OpenEngSB's management console to stop any running services.</p></div><div class="section" title="12.5.&nbsp;Step 1 - Source repository"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e1007"></a>12.5.&nbsp;Step 1 - Source repository</h2></div></div></div><div class="mediaobject" align="center"><img src="graphics/ci_mvnversion.png" align="middle"><div class="caption">check maven and jdk version</div></div><p>It turns out, we actually need a sample project before we can start developing and testing our CI tool. In this tutorial we will be using Apache Maven for project and source management and a small <span class="command"><strong>Hello World</strong></span> application written in Java. For this to work flawlessly we need JDK 1.6+ (<a class="link" href="http://www.oracle.com/technetwork/java/javase/downloads/index.html" target="_top">download</a>) and Maven 3+ (<a class="link" href="http://maven.apache.org/download.html" target="_top">download</a>) to be set up on the computer.</p><div class="mediaobject" align="center"><img src="graphics/ci_tutorial.png" align="middle"><div class="caption">tutorial project package</div></div><p>You may download and extract the openengsb-tutorial (<a class="link" href="/org/openengsb/docs/openengsb-docs-examples/2.0.0-SNAPSHOT/openengsb-docs-examples-2.0.0-SNAPSHOT-citutorial.zip" target="_top">download</a>) project that works out of the box or set up your own sample project via maven archetypes. Put the project files in a memorable location (i.e. "/home/user/Desktop/openengsb-tutorial" or "C:\users\user\desktop\openengsb-tutorial") and that's about it for now.</p></div><div class="section" title="12.6.&nbsp;Step 2 - Building the source code"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e1036"></a>12.6.&nbsp;Step 2 - Building the source code</h2></div></div></div><div class="mediaobject" align="center"><img src="graphics/ci_login.png" align="middle"><div class="caption">login</div></div><p>You could certainly build the project using Maven, but we want this to happen from within OpenEngSB. Open up your browser and go to the web interface at <a class="link" href="http://localhost:8090/openengsb" target="_top">http://localhost:8090/openengsb</a>. Authenticate using the <span class="command"><strong>Login</strong></span> link as "admin" with password "password".</p><div class="mediaobject" align="center"><img src="graphics/ci_testclient.png" align="middle"><div class="caption">test client</div></div><p>Switch to the <span class="command"><strong>Test client</strong></span> tab and check whether the <span class="command"><strong>build domain</strong></span> is available to accept commands.</p><div class="mediaobject" align="center"><img src="graphics/ci_feature.png" align="middle"><div class="caption">install connector in console</div></div><p>As the <span class="command"><strong>build domain</strong></span> is not shown, we will need to go to OpenEngSB's console. Use the "features:install openengsb-connector-maven" command to load the tool connector for Apache Maven. The tool connector allows OpenEngSB to communicate with an external service or application, Maven in this case. By loading the connector OpenEngSB also loads the domains associated with the connector. A domain is a generic interface that is implemented by specific connectors. For example, the build domain offers a generic function to build a software project. Whether this is done by Apache Maven, an Ant script or a plain compiler depends on the connector chosen by the user, but does not affect the basic model of our CI tool that simply "builds" the source. Using this technique specific tools can be exchanged quickly and transparently while data-flow and process models are completely unaffected.</p><div class="mediaobject" align="center"><img src="graphics/ci_newconnector.png" align="middle"><div class="caption">create new connector instance</div></div><p>Now let us return to the web interface. After a page refresh we are able to create a new Maven connector instance by following the <span class="command"><strong>new</strong></span> link next to the connector description.</p><div class="mediaobject" align="center"><img src="graphics/ci_buildconnector.png" align="middle"><div class="caption">setup build connector</div></div><p>The service id is an arbitrary name that can be referred to later on, i.e. <span class="command"><strong>builder</strong></span>. The project path refers to the local copy of the source repository, i.e. "/home/user/Desktop/openengsb-tutorial". Finally, the maven command is the command line option handed to Apache Maven, i.e. "clean build". Whenever the connector is ordered to build the project it will now execute "mvn clean compile" in the project directory of openengsb-tutorial. Click save to create the connector instance.</p><div class="mediaobject" align="center"><img src="graphics/ci_testbuilder.png" align="middle"><div class="caption">test build connector</div></div><p>It is time for some action. Scroll down all the way in the <span class="command"><strong>Test Client</strong></span> tab, navigate to the <span class="command"><strong>BuildDomain</strong></span> in the tree view and click the <span class="command"><strong>builder</strong></span> service. From the drop down menu below select <span class="command"><strong>build()</strong></span> and click the "Call" button. When the project is built successfully a "Method called successfully" message appears.</p><div class="mediaobject" align="center"><img src="graphics/ci_helloworld.png" align="middle"><div class="caption">hello world</div></div><p>Let us check the directory of openengsb-tutorial to find the newly created <span class="command"><strong>target</strong></span> directory. Using a console we can navigate to the <span class="command"><strong>classes</strong></span> sub-folder and run "java org.openengsb.Main". It returns "Hello World!". Congratulations, you have just implemented the core functionality of our CI tool.</p><p>In case an error message is returned, we need to check the connector configuration. Please make sure that Maven is able to build the project by manually executing "mvn clean build" in the project directory of openengsb-tutorial. If this does not work out, most likely the setup of either Maven or JDK are incorrect. If it works however, please check the configuration of the connector by navigating to the <span class="command"><strong>builder</strong></span> service in the web interface again and clicking the "Edit Service" button.</p></div><div class="section" title="12.7.&nbsp;Step 3 - Testing binaries"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e1132"></a>12.7.&nbsp;Step 3 - Testing binaries</h2></div></div></div><p>The next step in building the CI tool is implementation of automated testing. We can use the <span class="command"><strong>test domain</strong></span> to achieve this. Conveniently, the Maven connector also exports this type of functionality and we do not to load any additional features in the management console.</p><div class="mediaobject" align="center"><img src="graphics/ci_testconnector.png" align="middle"><div class="caption">setup test connector instance</div></div><p>Use the <span class="command"><strong>Test client</strong></span> tab and create a new instance of the Maven connector for the "test" domain. It works the same way as before. The Service Id is an arbitrary name, i.e. <span class="command"><strong>tester</strong></span>. The project path points at the location of openengsb-tutorial's base directory, i.e. "/home/user/Desktop/openengsb-tutorial", and the maven command indicates the command line arguments passed to Maven, i.e. "test". Click save to create the connector instance.</p><div class="mediaobject" align="center"><img src="graphics/ci_testtester.png" align="middle"><div class="caption">test test connector (yes, that's necessary)</div></div><p>We are also going to test the newly created connector. Use the tree view at the bottom of the page to navigate to <span class="command"><strong>TestDomain</strong></span> and select the <span class="command"><strong>tester</strong></span> service. In the drop down box below choose <span class="command"><strong>runTests()</strong></span> and click the "Call" button. If the "method called successfully" message is returned, the Maven connector ran the rigorous unit tests on our sample application and they were passed with flying colors.</p><div class="mediaobject" align="center"><img src="graphics/ci_sendeventpage.png" align="middle"><div class="caption">send event page</div></div><p>In case you are wondering about the output of the test suite go to the <span class="command"><strong>Send Event page</strong></span>. There you will find an audit list of all events processed by OpenEngSB and their corresponding payload, i.e. the output of the test run. The list behaves like a log file with most recent events appended to the bottom. In OpenEngSB any input from connectors is processed by domains and packaged in form of events. Every time an event is raised it can be matched by a rule in a central rule-base and cause a reaction of the system possibly invoking different domains or spawning additional events. By editing the rule-base we become able to link different actions together. Depending on the outcome of an action, we may receive different events, i.e. build success or build failure. By creating separate rules for each case we can react accordingly and by chaining multiple actions and events we could create a longer decision tree or process model.</p></div><div class="section" title="12.8.&nbsp;Step 4 - Notification Process"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e1179"></a>12.8.&nbsp;Step 4 - Notification Process</h2></div></div></div><p>In the final step we link the build and test stages together and add functionality to output results of the process. For this purpose we will create a small number of rules that react to events generated by the build and test stage. To keep things simple we do not add further connectors and assume that the build process is started by calling the <span class="command"><strong>builder</strong></span>'s "build()" method in the <span class="command"><strong>Test client</strong></span> web UI.</p><p>We are going to write the results of the build and test stage to the management console of OpenEngSB. We will notify about the build starting and its outcome. Also, in case the build works out successfully we will automatically start the test process. Hence, we need rules matching "BuildStartEvent" and "BuildSuccessEvent" that write output to the console and potentially activate the test connector.</p><div class="mediaobject" align="center"><img src="graphics/ci_ruleeditor.png" align="middle"><div class="caption">rule base editor</div></div><p>The easiest way to edit the rule-base of our OpenEngSB instance is the editor area at the bottom of the <span class="command"><strong>Send Event page</strong></span>. You can find event types and names by checking the event log displayed on the page and create rules manually in the editor below. The rules are written in plain text, based on Drools (<a class="link" href="http://www.jboss.org/drools/documentation" target="_top">documentation</a>) and Java standards. They are quickly understood, just take a look at the <span class="command"><strong>auditEvent</strong></span> rule used to generate the event log displayed on top of the page. You can display the rule by choosing "Rule" in the left-most drop-down box and "org.openengsb.auditEvent" in the second one. The text editor now shows that there is a <span class="command"><strong>when</strong></span> section that acts as filter for incoming events and there is a <span class="command"><strong>then</strong></span> section that describes the actions to be taken in case of a match.</p><div class="mediaobject" align="center"><img src="graphics/ci_buildrule.png" align="middle"><div class="caption">build started rule</div></div><p>Let us start out and create our own rule. We will inform the user via console when a build process starts. Click the <span class="command"><strong>new</strong></span> button next to the drop-down boxes, enter a name for the newly created rule, i.e. "buildStarted", and save it. After selecting the rule in the drop-down box the text editor actually shows the same content as for the audit event. Do not be confused, it's the default template. You can start editing right away. <span class="command"><strong>Note</strong></span>: Writing output directly to the console without using a logger service is considered bad practice. Yet, it's simple and sufficient for demonstration purposes.</p><pre class="programlisting">
    
when
  Event(type == "BuildStartEvent")
then
  System.out.println("Build started");
    </pre><p>This rule matches "BuildStartEvent" and prints a line to the console window. Click <span class="command"><strong>save</strong></span> to prepare the rule for testing. Switch to the <span class="command"><strong>Test client</strong></span> tab, select the <span class="command"><strong>builder</strong></span> and call the "build()" method. If things work out, you'll instantly see the "Build started" notification pop up in the management console.</p><p>It's time to push this further. Create another rule, i.e. "buildSuccessful" and edit it to look like this:</p><pre class="programlisting">
    
when
  Event(type == "BuildSuccessfulEvent")
then
  System.out.println("Build successful, running tests");
  tester.runTests();
    </pre><p><span class="command"><strong>Note</strong></span>: as of OpenEngSB 1.1.2 there is a bug in the editor that prevents connector invocations ("connectorId.doSomething()") from working correctly.</p><div class="mediaobject" align="center"><img src="graphics/ci_consoleoutput.png" align="middle"><div class="caption">console output</div></div><p>The rule also matches "BuildSuccessEvent" and prints a line to the console window. In addition, however, it calls a method provided by the test connector. Remember the "runTests()" method you called in the <span class="command"><strong>tester</strong></span> service by using the test client before? This has exactly the same effect but replaces manual UI interaction with an automated response. Click <span class="command"><strong>save</strong></span> and kick off another build using the <span class="command"><strong>Test client</strong></span> again. There you go: "Build started" and "Build successful, running tests".</p><p><span class="command"><strong>Congratulations</strong></span>, you have created a basic CI tool! The foundations have been extended to allow for easy auditing and extensibility. Of course, at the moment it simply replicates the functionality of existing CI tools, but it can be easily extended using SCM access, reporting and notification tools and work together with project management software and PIM applications. Take a look on the long list of available domains and tool connectors.</p><p>If you want to do some more practice you can add more rules, i.e. for "TestSuccessEvent" or "BuildFailureEvent". You can find event types, names and properties by checking the event log displayed on the <span class="command"><strong>Send Event page</strong></span>.</p></div><div class="section" title="12.9.&nbsp;Further Reading"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e1273"></a>12.9.&nbsp;Further Reading</h2></div></div></div><p>There are a number of different HowTo's and tutorials in the online documentation. They describe different scenarios for <a class="link" href="howto.setup.html" title="Chapter&nbsp;4.&nbsp;HowTo - Setup OpenEngSB for development (First steps)">setup</a>, <a class="link" href="howto.logging.html" title="Chapter&nbsp;6.&nbsp;HowTo - First steps with the OpenEngSB (Send mails via the OpenEngSB)">connectors and domains</a> and <a class="link" href="howto.contexteditor.html" title="Chapter&nbsp;7.&nbsp;HowTo - Events with the OpenEngSB (Using the logging service)">event processing</a>. Also, the user manual contains additional information about the topics discussed and numerous OpenEngSB subprojects, i.e. <a class="link" href="http://opencit.openengsb.org" target="_top">OpenCIT</a> and <a class="link" href="http://openticket.openengsb.org" target="_top">OpenTicket</a>, can be used for reference.</p></div></div><div xmlns:fo="http://www.w3.org/1999/XSL/Format" class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="howto.composite.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="openengsb-manual.html">Home</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="user.manual.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;11.&nbsp;HowTo - Combine mulitple connectors&nbsp;</td><td width="20%" align="center"><span style="color:white;font-size:85%;"><a href="http://openengsb.org/" title="OpenEngSB Community">OpenEngSB Community</a></span></td><td width="40%" align="right" valign="top">&nbsp;Part&nbsp;III.&nbsp;OpenEngSB Framework</td></tr></table></div></body></html>