<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;10.&nbsp;HowTo - Interact with the OPENENGSB Remotely</title><link rel="stylesheet" href="css/html.css" type="text/css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.75.2"><link rel="home" href="openengsb-manual.html" title="OpenEngSB Manual"><link rel="up" href="tutorials.manual.html" title="Part&nbsp;II.&nbsp;Tutorials"><link rel="prev" href="howto.clientProject.html" title="Chapter&nbsp;9.&nbsp;HowTo - Create a Client-Project for the OpenEngSB"><link rel="next" href="howto.composite.html" title="Chapter&nbsp;11.&nbsp;HowTo - Combine mulitple connectors"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div xmlns:fo="http://www.w3.org/1999/XSL/Format" id="top"><div id="header"><div class="projectlogo"></div></div></div><div xmlns:fo="http://www.w3.org/1999/XSL/Format" class="mhSpacer"></div><div class="chapter" title="Chapter&nbsp;10.&nbsp;HowTo - Interact with the OPENENGSB Remotely"><div class="titlepage"><div><div><h2 class="title"><a name="howto.remote"></a>Chapter&nbsp;10.&nbsp;HowTo - Interact with the OPENENGSB Remotely</h2></div></div></div><div class="section" title="10.1.&nbsp;Using JMS proxying"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="howto.remote.jms"></a>10.1.&nbsp;Using JMS proxying</h2></div></div></div><p>The current JMS Connector allows for internal method calls being redirected via JMS as well as internal
      services being called.</p><p>For resources regarding JMS please take a look at the according <a class="link" href="http://en.wikipedia.org/wiki/Java_Message_Service" target="_top">Wikipedia Page</a> and for specific language
      bindings take a look at <a class="link" href="http://activemq.apache.org/connectivity.html" target="_top">ActiveMQ</a></p><div class="section" title="10.1.1.&nbsp;Proxying internal Connector calls"><div class="titlepage"><div><div><h3 class="title"><a name="d0e751"></a>10.1.1.&nbsp;Proxying internal Connector calls</h3></div></div></div><p>Whenever now a method is sent through the JMS Port the call is marshalled and sent via JMS to a queue named
        "receive"". The marshalling is done via JSON. The mapping has the parameters methodName, args, classes, metadata
        and potentially answer and callId. methodName gives the name of the method to call. Args are the serialised
        parameters of the method. classes are the types of the arguments. This way it is easy to unmarshall the args
        into the appropriate classes. metadata is a simple Map which stores key value pairs. answer can simply be yes or
        no and denotes if the methodcall wants an answer to the call. callId gives the return queue the caller will
        listen to for an answer. </p><p>An answer can have the type, arg, className and metaData properties. type can be Object, Exception or Void.
        arg is the serialised form of the return argument. className is the runtime class of the arg for
        deserialisation. metadata is a simple key value store. </p><div class="section" title="10.1.1.1.&nbsp;HowTo call an external service via proxies"><div class="titlepage"><div><div><h4 class="title"><a name="d0e758"></a>10.1.1.1.&nbsp;HowTo call an external service via proxies</h4></div></div></div><p>This section will give a short introduction how to instantiate a proxy and call an external
          connector</p><p>First you have to go to the TestClient to instantiate a new Proxy. Select the Domain you want to have
          proxied and click New Proxy for that Domain.</p><div class="mediaobject" align="center"><img src="graphics/testclient.png" align="middle"><div class="caption">Testclient new proxy link</div></div><p>Then you have to set the correct values for the proxy properties. The Service Id is a unique value that
          identifies the proxy in the OPENENGSB system. The Port Id defines to Port to be used for sending the request.
          "jms-json" is a currently supported Port that sends the request via a json encoded JMS message. The
          destination describes the endpoint the message should be sent to. When using jms-json the domain and port of
          the JMS provider have to be set. When calling a remote connector the unique id of the remote service or
          connector has to be provided. This way the remote service can identify, load and call a certain service. If
          the call is not intended to go to another OPENENGSB, or the external service needs no identification of the
          service to call the remote service id can be ommited.</p><div class="mediaobject" align="center"><img src="graphics/create-proxy.png" align="middle"><div class="caption">Create Proxy</div></div><p>After saving the proxy you should be able to test it via the TestClient page. Following is an example of
          an unsecure call:</p><pre class="programlisting">{
  "authenticationData": {
    "className":"org.openengsb.core.api.security.model.UsernamePasswordAuthenticationInfo",
    "data": {
      "username":"admin",
      "password":"password"
    }
  },
  "timestamp":42,
  "message": {
    "callId":"xyz",
    "answer":true,
    "methodCall": {
      "classes": [
        "java.lang.String",
        "org.openengsb.core.api.workflow.model.ProcessBag"
      ],
      "methodName": "executeWorkflow",
      "metaData": {
        "serviceFilter": "(objectClass=org.openengsb.core.api.workflow.WorkflowService)",
        "contextId": "foo"
      },
      "args": [
        "simpleFlow",
        {
        }
      ]
    }
  }
}</pre><p> IF you would like to use security instead you should prefer the following call: </p><pre class="programlisting">{
{
  "encryptedContent":"encodedMessage", // Base 64 and encryped string of the message above
  "encryptedKey":"encodedKey" // The encoded key
}</pre><p>
        </p><div class="mediaobject" align="center"><img src="graphics/call-proxy.png" align="middle"><div class="caption">Test a proxy</div></div><p>When proxying connector calls you have to provide an answer to every call, as the system blocks until it
          gets an answer. You have to send a JSON message containing a type string parameter, which can be Object,
          Exception or Void depending on the return argument of the method, arg where you simply serialise the Return
          Object, so it can be deserialised into the correct object later and className which gives the exact class that
          has to be used for deserialisation. The request contains a parameter callId which is the name of the queue the
          answer has to be sent to.</p><pre class="programlisting">{"type":"Object","className":"org.openengsb.core.ports.jms.JMSPortTest$TestClass",
          "metaData":{"test":"test"},"arg":{"test":"test"}}</pre><p>Whenever a call to this proxy is then made a new JMS message will be sent to the "receive" queue on the
          destination you entered. The exact make up of the message was already described. When implementing an external
          connector it is best to test the call you want to receive first via the TestClient, so you get the exact
          message that you will have to work with.</p><p>Please always keep in mind security. By default security is turned on. If you want to turn it off please
          take a look into the <code class="code">etc/system.properties</code> file. While using no security for testing is very
          interesting we would not advise you to send unencrypted messages in a production environment.</p></div></div><div class="section" title="10.1.2.&nbsp;Calling internal Services"><div class="titlepage"><div><div><h3 class="title"><a name="d0e802"></a>10.1.2.&nbsp;Calling internal Services</h3></div></div></div><p>To call an internal Service send a methodcall as described before to the "receive" queue on the server you
        want to call. The service works exactly as defined before. There currently are two ways of specifying which
        service to address. </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"> serviceId: This will call the service that was exported with the specified "id"-property. It
            behaves like the following Filter in OSGi-syntax: <code class="code">(id=&lt;serviceId&gt;)</code></li><li class="listitem"> serviceFilter: This way you can specify any filter in OSGi-syntax to adress the service, so it is
            not necessary to bind the client to a specific id, but to other properties as well (e.g.
              <code class="code">location.root</code>, <code class="code">location.&lt;context&gt;</code>, <code class="code">objectClass</code>, ...)
          </li></ul></div><p> You can also use both attributes (serviceId and serviceFilter). It will create a filter matching
        both constraints. </p><p>Example: if you want to execute a workflow via the WorkflowService send</p><code class="code">{"callId":"12345","answer":true,"classes":["java.lang.String",
        "org.openengsb.core.api.workflow.model.ProcessBag"],
        "methodName":"executeWorkflow","metaData":{"serviceId":"workflowService",
        "contextId":"foo"},"args":["simpleFlow", {}]}</code><p>Please be aware that the flow the above method tries to call (simpleFlow) is not available by default on the
        OpenEngSB. To make sure that there's a flow you can call install the flow in the OpenEngSB. Therefore start the
        OpenEngSB and go to the <a class="link" href="http://localhost:8090/openengsb/SendEventPage/" target="_top">SendEventPage</a>.
        There choose to create a new process and press new. Now enter simpleFlow as processname and past the following
        process: </p><pre class="programlisting">&lt;process xs:schemaLocation="http://drools.org/drools-5.0/process 
  drools-processes-5.0.xsd" type="RuleFlow" name="simpleFlow" id="simpleFlow" 
  package-name="org.openengsb" xmlns="http://drools.org/drools-5.0/process" 
  xmlns:xs="http://www.w3.org/2001/XMLSchema-instance"&gt;
 &lt;header&gt;
  &lt;variables&gt;
   &lt;variable name="processBag"&gt;
    &lt;type name="org.drools.process.core.datatype.impl.type.ObjectDataType" 
     className="org.openengsb.core.api.workflow.model.ProcessBag"/&gt;
   &lt;/variable&gt;
  &lt;/variables&gt;
 &lt;/header&gt;
 &lt;nodes&gt;
  &lt;start id="1" name="Start" x="16" y="16" width="91" height="48"/&gt;
  &lt;end id="2" name="End" x="21" y="168" width="80" height="40"/&gt;
  &lt;actionNode id="3" name="Action" x="21" y="96" width="80" height="40"&gt;
   &lt;action type="expression" dialect="mvel"&gt;
    processBag.addProperty("test", 42);
    processBag.addProperty("alternativeName", "The answer to life the universe and everything");
   &lt;/action&gt;
  &lt;/actionNode&gt;
 &lt;/nodes&gt;
 &lt;connections&gt;
  &lt;connection from="3" to="2"/&gt;
  &lt;connection from="1" to="3"/&gt;
 &lt;/connections&gt;
&lt;/process&gt;</pre><p> After pressing save you can access the process via the message shown above. </p><p>to the receive queue on the OPENENGSB JMS Port which is started by default on Port 6549. Make sure that
        classes and args has the same number of arguments. If you just want an object to be instantiated, but have no
        corresponding values that should be set for the object simply add {} (as in the example above) which will
        instantiate the object but recognize, that no values have to be set on the object. {"name" : "SomeName"} would
        on the other hand call the setName method with SomeName.</p><p>The response to the above message will be returned on a queue you've pasted via the callId field.</p></div><div class="section" title="10.1.3.&nbsp;Examples"><div class="titlepage"><div><div><h3 class="title"><a name="d0e840"></a>10.1.3.&nbsp;Examples</h3></div></div></div><p> We provide examples in different languages how to connect to the OpenEngSB. The examples are grouped
        according to language and the documentation to the different examples are directly done in the code of the
        examples. We try to keep those examples as good as possible up-to-date, but do not gurantee that they all work
        as expected since we can't add them to our integration tests. If you want to provide examples in different
        languages you're always welcomed to provide them. </p><div class="section" title="10.1.3.1.&nbsp;Connect With Python"><div class="titlepage"><div><div><h4 class="title"><a name="d0e845"></a>10.1.3.1.&nbsp;Connect With Python</h4></div></div></div><p>To test the OPENENGSB JMS implementation with Python please follow the <a class="link" href="https://github.com/openengsb/openengsb/blob/master/docs/examples/src/main/python/PythonClient.txt" target="_top">instructions</a>
        </p><p>The example can be downloaded <a class="link" href="/org/openengsb/docs/openengsb-docs-examples/2.0.0-SNAPSHOT/openengsb-docs-examples-2.0.0-SNAPSHOT-python.zip" target="_top">here</a></p></div><div class="section" title="10.1.3.2.&nbsp;Connect With CSharp"><div class="titlepage"><div><div><h4 class="title"><a name="developer.plugins.csharp"></a>10.1.3.2.&nbsp;Connect With CSharp</h4></div></div></div><p>The CSharp connector is written on basis of the Apache ActiveMQ JMS connector. There an EngSB.sln file.
          This project file has been developed with SharpDevelop 4, but is also tested with VisualStudio 2008 CSharp
          Express Edition with the .Net Framework 4.</p><p>The example can be downloaded <a class="link" href="/org/openengsb/docs/openengsb-docs-examples/2.0.0-SNAPSHOT/openengsb-docs-examples-2.0.0-SNAPSHOT-csharp.zip" target="_top">here</a></p></div><div class="section" title="10.1.3.3.&nbsp;Connect With Perl"><div class="titlepage"><div><div><h4 class="title"><a name="developer.plugins.perl"></a>10.1.3.3.&nbsp;Connect With Perl</h4></div></div></div><p>As shown in this example you can connect to the OpenEngSB in a similar way as with Python or
          CSharp.</p><p>The example can be downloaded <a class="link" href="/org/openengsb/docs/openengsb-docs-examples/2.0.0-SNAPSHOT/openengsb-docs-examples-2.0.0-SNAPSHOT-perl.zip" target="_top">here</a></p></div></div></div><div class="section" title="10.2.&nbsp;Using WS Proxing"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e875"></a>10.2.&nbsp;Using WS Proxing</h2></div></div></div><p>TBW</p></div><div class="section" title="10.3.&nbsp;Internal Specialities"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e880"></a>10.3.&nbsp;Internal Specialities</h2></div></div></div><p>Basically there is nothing special to do to get up a service. Still, since java has no static type information
      there is no possibility to marshal things like a <code class="code">java.util.List</code> of options. The fix we've introduced
      for this problem is to annotate parameters and define a custom marshaller. Therefore create a class with a default
      constructor extending CustomJsonMarshaller. Then annotate the parameter of the implementations you're using with
      the UseCustomJasonMarshaller annotation adding the Marshaller class. That's it. The framework will automatically
      create the mapper and call the transform method for you. </p><p> Since there is an issue right now with Aries Proxies hiding parameter annotations the
      CustomMarshallerRealTypeAccess interface provides a workaround for the problem. In case this interface is found
      the class provided by it is used for searching. Otherwise the class directly is scanned.</p></div></div><div xmlns:fo="http://www.w3.org/1999/XSL/Format" class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="howto.clientProject.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="openengsb-manual.html">Home</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="howto.composite.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;9.&nbsp;HowTo - Create a Client-Project for the OpenEngSB&nbsp;</td><td width="20%" align="center"><span style="color:white;font-size:85%;"><a href="http://openengsb.org/" title="OpenEngSB Community">OpenEngSB Community</a></span></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;11.&nbsp;HowTo - Combine mulitple connectors</td></tr></table></div></body></html>