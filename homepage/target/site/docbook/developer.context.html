<!--

    Licensed to the Austrian Association for Software Tool Integration (AASTI)
    under one or more contributor license agreements. See the NOTICE file
    distributed with this work for additional information regarding copyright
    ownership. The AASTI licenses this file to you under the Apache License,
    Version 2.0 (the "License"); you may not use this file except in compliance
    with the License. You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

-->

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia at Sep 17, 2011 -->
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>
    
    
    
      Chapter 15. Context Management
    </title>
    <style type="text/css" media="all">
      @import url("../css/maven-base.css");
      @import url("../css/maven-theme.css");
      @import url("../css/site.css");

            
      <!--[if IE]>
      @import url("../css/site-ie-fixes.css");
      <![endif]-->
    </style>

        <!--[if IE]><link rel="stylesheet" href="../css/site-ie-fixes.css" type="text/css" media="all" /><![endif]-->
    <link rel="icon" type="image/x-icon" href="../images/openengsb.ico" />
    <link rel="shortcut icon" type="image/x-icon" href="../images/openengsb.ico" />
    <link rel="stylesheet" href="../css/print.css" type="text/css" media="print" />
        <meta name="Date-Revision-yyyymmdd" content="20110917" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
                                                    
<script type="text/javascript">var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-17453231-1']);
        _gaq.push(['_trackPageview']);

        (function() {
          var ga = document.createElement('script'); ga.type =
          'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' :
          'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0];
          s.parentNode.insertBefore(ga, s);
        })();</script>
                    </head>
  <body class="composite">
<div id="header">
    <div id="banner">
                  <span id="bannerLeft">
                                                <img src="../images/openengsb_small.png" alt="" />
                </span>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
                                        <div class="xleft">
        Last Published: 2011-09-17
                  &nbsp;| Version: 2.0.0-SNAPSHOT "Qualified Q"
                      </div>
            <div class="xright">            <a href="http://openengsb.org/" class="externalLink" target="_blank">Final Release</a>
            |
                <a href="http://openengsb.org/milestone" class="externalLink" target="_blank">Milestone Release</a>
            |
                <a href="http://openengsb.org/nightly" class="externalLink" target="_blank">Nightly Release</a>
              
                              </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
</div>   
<div id="body">
	<div id="content">
    <div id="leftColumn">
      <div id="navcolumn">
             
                                                        <div class="menuItem"><h5>OpenEngSB</h5></div>
                  <ul>
                  <li class="none">
                  <a href="../index.html">Welcome</a>
            </li>
                  <li class="none">
                  <a href="../about.html">What is OpenEngSB?</a>
            </li>
                  <li class="none">
                  <a href="../downloads.html">Downloads</a>
            </li>
                  <li class="none">
                  <a href="https://github.com/openengsb/openengsb/raw/master/CHANGELOG.md" class="externalLink" target="_blank">Changelog</a>
            </li>
                  <li class="none">
                  <a href="https://github.com/openengsb/openengsb/blob/master/KNOWN_ISSUES.md" class="externalLink" target="_blank">Known Issues</a>
            </li>
                  <li class="none">
                  <a href="../sponsors.html">Sponsors</a>
            </li>
                  <li class="none">
                  <a href="../subprojects.html">Subprojects</a>
            </li>
          </ul>
                       <div class="menuItem"><h5>Quickstart</h5></div>
                  <ul>
                  <li class="none">
                  <a href="../docbook/howto.setup.html">Installation</a>
            </li>
                  <li class="none">
                  <a href="../docbook/howto.logging.html">Connectors and Domains</a>
            </li>
                  <li class="none">
                  <a href="../docbook/howto.contexteditor.html">Events</a>
            </li>
          </ul>
                       <div class="menuItem"><h5>Documentation</h5></div>
                  <ul>
                  <li class="none">
                  <a href="../manual/index.html">Manual</a>
            </li>
                  <li class="none">
                  <a href="../reference/faq.html">FAQ</a>
            </li>
                  <li class="none">
                  <a href="../reference/additional.html">Articles</a>
            </li>
                  <li class="none">
                  <a href="http://www.youtube.com/user/cdflexvideo" class="externalLink" target="_blank">Youtube Channel</a>
            </li>
          </ul>
                       <div class="menuItem"><h5>Community</h5></div>
                  <ul>
                  <li class="none">
                  <a href="../community/mailinglists.html">Mailing Lists</a>
            </li>
                  <li class="none">
                  <a href="../community/irc.html">IRC Channels</a>
            </li>
                  <li class="none">
                  <a href="http://twitter.com/openEngSB" class="externalLink" target="_blank">Twitter</a>
            </li>
                  <li class="none">
                  <a href="http://www.facebook.com/group.php?gid=208312030232" class="externalLink" target="_blank">Facebook</a>
            </li>
          </ul>
                       <div class="menuItem"><h5>Development</h5></div>
                  <ul>
                  <li class="none">
                  <a href="../contribution.html">Contribution</a>
            </li>
                  <li class="none">
                  <a href="../source-repository.html">Source</a>
            </li>
                  <li class="none">
                  <a href="../issue-tracking.html">Issues</a>
            </li>
                  <li class="none">
                  <a href="../integration.html">CI</a>
            </li>
                  <li class="none">
                  <a href="../team-list.html">Team</a>
            </li>
          </ul>
                   
                                    </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        
  
  
    
      
      
    
    
      
        
          
            <div class="title"><h2 class="title">
              <a name="developer.context" id="developer.context"></a>Chapter&#xa0;15.&#xa0;Context
              Management
            <a name="Chapter15.Context______________Management"></a></h2>
          
        
      
      <p>
        The context is one of the most important core concepts of
        the openengsb. It allows to reuse predefined workflows in
        several contexts. A context may often represent a project
        or subproject. So it is possible to execute the same
        workflow with the project-specific tool-instances and other
        metadata (like contact-information).
      </p>
      <p>
        To determine in which context an action should be executed
        a thread-local variable is used. The <a class="link" href="https://github.com/openengsb/openengsb/blob/master/core/api/src/main/java/org/openengsb/core/api/context/ContextHolder.java" target="_top">ContextHolder</a> keeps track of this
        variable (the current threads' context). Invoking the set-
        and get-method will always manipulate the context of the
        current Thread. When a new Thread is spawned it inherits
        the context from the parent thread.
      </p>
      <p>
        <span class="emphasis"><i>Attention:</i></span> When
        using Theadpools, the ContextHolder may malfunction (i.e.
        return the context of some previous task that was run in
        the same thread). Use
      </p>
<div class="programlisting"><pre>
ThreadLocalUtil.contextAwareExecutor(ExecutorService)
</pre></div>
      <p>
        to convert any executor to a context-aware one.
        ExecutorServices returned by this method ensure that the
        submitted tasks are executed in the same context as the
        thread they were submitted from.
      </p>
      <p>
        This way connector-implementations and other client
        projects always can handle actions according to the current
        context, and execute actions in specific a specific
        context. So when a person with a certain role in the
        project (e.g. project manager) needs to be notified of some
        event, the value of his contact-address is specific to the
        context of the project(s) he is managing.
      </p>
      
        
          
            
              </div><div class="title" style="clear: both"><h2 class="title" style="clear: both">
                <a name="developer.context.wiring" id="developer.context.wiring"></a>15.1.&#xa0;Wiring
                services
              <a name="a15.1.Wiring________________services"></a></h2>
            
          
        
        <p>
          The context is also used to handle the wiring of services
          in workflows. Suppose there are two projects that use
          their own SCM-repositories and for both repositories
          connector-instances were created to poll them. When
          executing a workflow contains an action that polls the
          SCM, the correct service ca be picked by looking up the
          current thread's context.
        </p>
        <p>
          In general workflows have references to several domains
          and other services which they interact with during
          execution. Each project might have their own tools behind
          these domains, so these references must be resolved at
          runtime depending on the current context.
        </p>
        <p>
          For this to work the workflow-engine declares global
          variables that are used in rules and processes. A
          variable is resolved by looking up the service with the
          same name in the current context. If no service with that
          name is available in the context it is looked up in the
          &quot;root&quot;-context.
        </p>
        <p>
          In detail the wiring is handled via the
          service-properties. Services contain properties where the
          key is of the format &quot;location.&lt;contextid&gt;&quot;. The
          value is a list of &quot;locations&quot; represented by an array of
          strigns. So a service may have several locations in
          several contexts.
        </p>
        <p>
          When a global variable is accessed during the execution
          of an action (from a process or rule), the osgi-context
          is queried for the correspinding service. The service
          wired to this variable must have location with the same
          name as the variable. The service is searched in the
          current context and the root-context. If no service is
          found, the action is stalled for 30 seconds. If there is
          still no service found an Exception is thrown. Internally
          this is handled using proxies. When the workflow service
          is started, all globals are populated with proxies, that
          automatically resolve the service with the corresponding
          location when a method is invoked.
        </p>
        <p>
          Example: The auditing-service is registered with the
          interface AuditingDomain. The service has property
          &quot;location.root&quot; with value {&quot;auditing&quot;} (array with one
          element). The workflow engine contains a global named
          &quot;auditing&quot; and a rule that invokes a method on every
          Event that is processed. When the rule fires and the
          consequence is executed, the proxy representing
          &quot;auditing&quot;-global queries for a service with the
          location.currentContext or the location.root containing a
          location-entry &quot;auditing&quot;. Since root-services get a
          service-ranking of &quot;-1&quot; by default, the service current
          context's would supersede the service located in the
          root-context.
        </p>
      
    
    
      <hr />
      <table border="0" class="bodyTable" width="100%" summary="Navigation footer">
        <tr class="a">
          <td width="40%" align="left">
            <a href="architecture.html">Prev</a>&#xa0;
          </td>
          <td width="20%" align="center">
            <a href="openengsb-manual.html">Home</a>
          </td>
          <td width="40%" align="right">
            &#xa0;<a href="developer.persistence.html">Next</a>
          </td>
        </tr>
        <tr class="b">
          <td width="40%" align="left" valign="top">
            Chapter&#xa0;14.&#xa0;Architecture of the OpenEngSB&#xa0;
          </td>
          <td width="20%" align="center">
            <span style="color:white;font-size:85%;"><a class="externalLink" href="http://openengsb.org/" title="OpenEngSB Community">OpenEngSB
            Community</a></span>
          </td>
          <td width="40%" align="right" valign="top">
            &#xa0;Chapter&#xa0;16.&#xa0;Persistence in the OpenEngSB
          </td>
        </tr>
      </table>
    
  </div>

      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    </div>
</div>
    <div id="footer">
      <div class="xright">&#169;            2009-2011
                
                               - <a href="http://maven.apache.org/privacy-policy.html">Privacy Policy</a> <script type="text/javascript" src="http://www.ohloh.net/p/494725/widgets/project_thin_badge.js"></script></div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
