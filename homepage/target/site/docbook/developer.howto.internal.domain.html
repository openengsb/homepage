<!--

    Licensed to the Austrian Association for Software Tool Integration (AASTI)
    under one or more contributor license agreements. See the NOTICE file
    distributed with this work for additional information regarding copyright
    ownership. The AASTI licenses this file to you under the Apache License,
    Version 2.0 (the "License"); you may not use this file except in compliance
    with the License. You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

-->

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia at Sep 17, 2011 -->
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>
    
    
    
      Chapter 41. How To Create an Internal Domain
    </title>
    <style type="text/css" media="all">
      @import url("../css/maven-base.css");
      @import url("../css/maven-theme.css");
      @import url("../css/site.css");

            
      <!--[if IE]>
      @import url("../css/site-ie-fixes.css");
      <![endif]-->
    </style>

        <!--[if IE]><link rel="stylesheet" href="../css/site-ie-fixes.css" type="text/css" media="all" /><![endif]-->
    <link rel="icon" type="image/x-icon" href="../images/openengsb.ico" />
    <link rel="shortcut icon" type="image/x-icon" href="../images/openengsb.ico" />
    <link rel="stylesheet" href="../css/print.css" type="text/css" media="print" />
        <meta name="Date-Revision-yyyymmdd" content="20110917" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
                                                    
<script type="text/javascript">var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-17453231-1']);
        _gaq.push(['_trackPageview']);

        (function() {
          var ga = document.createElement('script'); ga.type =
          'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' :
          'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0];
          s.parentNode.insertBefore(ga, s);
        })();</script>
                    </head>
  <body class="composite">
<div id="header">
    <div id="banner">
                  <span id="bannerLeft">
                                                <img src="../images/openengsb_small.png" alt="" />
                </span>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
                                        <div class="xleft">
        Last Published: 2011-09-17
                  &nbsp;| Version: 2.0.0-SNAPSHOT "Qualified Q"
                      </div>
            <div class="xright">            <a href="http://openengsb.org/" class="externalLink" target="_blank">Final Release</a>
            |
                <a href="http://openengsb.org/milestone" class="externalLink" target="_blank">Milestone Release</a>
            |
                <a href="http://openengsb.org/nightly" class="externalLink" target="_blank">Nightly Release</a>
              
                              </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
</div>   
<div id="body">
	<div id="content">
    <div id="leftColumn">
      <div id="navcolumn">
             
                                                        <div class="menuItem"><h5>OpenEngSB</h5></div>
                  <ul>
                  <li class="none">
                  <a href="../index.html">Welcome</a>
            </li>
                  <li class="none">
                  <a href="../about.html">What is OpenEngSB?</a>
            </li>
                  <li class="none">
                  <a href="../downloads.html">Downloads</a>
            </li>
                  <li class="none">
                  <a href="https://github.com/openengsb/openengsb/raw/master/CHANGELOG.md" class="externalLink" target="_blank">Changelog</a>
            </li>
                  <li class="none">
                  <a href="https://github.com/openengsb/openengsb/blob/master/KNOWN_ISSUES.md" class="externalLink" target="_blank">Known Issues</a>
            </li>
                  <li class="none">
                  <a href="../sponsors.html">Sponsors</a>
            </li>
                  <li class="none">
                  <a href="../subprojects.html">Subprojects</a>
            </li>
          </ul>
                       <div class="menuItem"><h5>Quickstart</h5></div>
                  <ul>
                  <li class="none">
                  <a href="../docbook/howto.setup.html">Installation</a>
            </li>
                  <li class="none">
                  <a href="../docbook/howto.logging.html">Connectors and Domains</a>
            </li>
                  <li class="none">
                  <a href="../docbook/howto.contexteditor.html">Events</a>
            </li>
          </ul>
                       <div class="menuItem"><h5>Documentation</h5></div>
                  <ul>
                  <li class="none">
                  <a href="../manual/index.html">Manual</a>
            </li>
                  <li class="none">
                  <a href="../reference/faq.html">FAQ</a>
            </li>
                  <li class="none">
                  <a href="../reference/additional.html">Articles</a>
            </li>
                  <li class="none">
                  <a href="http://www.youtube.com/user/cdflexvideo" class="externalLink" target="_blank">Youtube Channel</a>
            </li>
          </ul>
                       <div class="menuItem"><h5>Community</h5></div>
                  <ul>
                  <li class="none">
                  <a href="../community/mailinglists.html">Mailing Lists</a>
            </li>
                  <li class="none">
                  <a href="../community/irc.html">IRC Channels</a>
            </li>
                  <li class="none">
                  <a href="http://twitter.com/openEngSB" class="externalLink" target="_blank">Twitter</a>
            </li>
                  <li class="none">
                  <a href="http://www.facebook.com/group.php?gid=208312030232" class="externalLink" target="_blank">Facebook</a>
            </li>
          </ul>
                       <div class="menuItem"><h5>Development</h5></div>
                  <ul>
                  <li class="none">
                  <a href="../contribution.html">Contribution</a>
            </li>
                  <li class="none">
                  <a href="../source-repository.html">Source</a>
            </li>
                  <li class="none">
                  <a href="../issue-tracking.html">Issues</a>
            </li>
                  <li class="none">
                  <a href="../integration.html">CI</a>
            </li>
                  <li class="none">
                  <a href="../team-list.html">Team</a>
            </li>
          </ul>
                   
                                    </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        
  
  
    
      
      
    
    
      
        
          
            <div class="title"><h2 class="title">
              <a name="developer.howto.internal.domain" id="developer.howto.internal.domain"></a>Chapter&#xa0;41.&#xa0;How
              To Create an Internal Domain
            <a name="Chapter41.How______________To_Create_an_Internal_Domain"></a></h2>
          
        
      
      <p>
        This chapter describes how to implement a domain for the
        OpenEngSB environment. A domain provides a common interface
        and common events and thereby defines how to interact with
        connectors for this domain. For a better description of
        what a domain exactly consists of, take a look at the
        architecture guide <a href="architecture.html" class="xref" title="Chapter 14. Architecture of the OpenEngSB">Chapter&#xa0;14,
        <i>Architecture of the OpenEngSB</i></a>.
      </p>
      
        
          
            
              </div><div class="title" style="clear: both"><h2 class="title" style="clear: both">
                <a name="d0e3516" id="d0e3516"></a>41.1.&#xa0;Prerequisites
              <a name="a41.1.Prerequisites"></a></h2>
            
          
        
        <p>
          In case it isn't known what a domain is and how it
          defines the interface and events for connectors, then <a href="architecture.html#architecture.concept.tooldomains" class="xref" title="14.4. OpenEngSB Tool Domains">Section&#xa0;14.4, &#x201c;
          OpenEngSB Tool Domains&#x201d;</a> is a good starting point.
        </p>
      
      
        
          
            
              </div><div class="title" style="clear: both"><h2 class="title" style="clear: both">
                <a name="d0e3523" id="d0e3523"></a>41.2.&#xa0;Creating a
                new domain project
              <a name="a41.2.Creating_a________________new_domain_project"></a></h2>
            
          
        
        <p>
          To get developers started creating a new domain a Maven
          archetype is provided for creating the initial project
          structure. The <tt>openengsb-maven-plugin</tt> (see <a href="developer.quickstart.html#developer.quickstart.tools.mavenplugin" class="xref" title="39.7.1. openengsb-maven-plugin">Section&#xa0;39.7.1, &#x201c;
          openengsb-maven-plugin&#x201d;</a>) or the <tt>etc/scripts/gen-domain.sh</tt> script
          (which only wraps the invocation of the plugin)
          simplifies the creation of a domain.
        </p>
        
          
            
              
                <div class="title"><h3 class="title">
                  <a name="d0e3536" id="d0e3536"></a>41.2.1.&#xa0;Using
                  the Maven Archetype
                <a name="a41.2.1.Using__________________the_Maven_Archetype"></a></h3>
              
            
          
          <p>
            It is not recommended to use the maven archetype
            directly, because the <span class="emphasis"><i>genDomain</i></span> goal of the
            openengsb-maven-plugin executes additional tasks, i.e.
            renaming of the resulting project. Furthermore it tries
            to make sure that the new project is consistent with
            the naming conventions of the OpenEngSB project.
          </p>
          <p>
            The following parameters have to be specified to
            execute the correct archetype:
          </p>
          
            <ul class="itemizedlist">
              <li class="listitem">
                archetypeGroupId - the groupId of the OpenEngSB
                domain archetype.
              </li>
              <li class="listitem">
                archetypeArtifactId - the artifactId of the
                OpenEngSB domain archetype.
              </li>
              <li class="listitem">
                archetypeVersion - the current version of the
                OpenEngSB domain archetype.
              </li>
            </ul>
          
          <p>
            The following parameters have to be defined for the
            parent of the new domain. It is not solely parent of
            the domain implementation, but parent of all connectors
            of this domain too.
          </p>
          
            <ul class="itemizedlist">
              <li class="listitem">
                groupId - the groupId of the project parent. Has to
                be &quot;org.openengsb.domains.&lt;yourDomain&gt;&quot;.
              </li>
              <li class="listitem">
                artifactId - the artifactId of the project parent.
                Has to be
                &quot;openengsb-domains-&lt;yourDomain&gt;-parent&quot;.
              </li>
              <li class="listitem">
                version - the version of the domain parent, which
                is usually equal to the current archetype version.
              </li>
              <li class="listitem">
                name - the name of the parent module. Has to be
                &quot;OpenEngSB :: Domains :: &lt;yourDomain&gt; ::
                Parent&quot;
              </li>
            </ul>
          
          <p>
            The following parameters have to be defined for the
            implementation of the new domain.
          </p>
          
            <ul class="itemizedlist">
              <li class="listitem">
                implementationArtifactId - the implementation
                artifact id. Has to be
                &quot;openengsb-domains-&lt;yourDomain&gt;-implementation&quot;.
              </li>
              <li class="listitem">
                package - the package for the source code of the
                domain implementation. Has to be
                &quot;org.openengsb.domains.&lt;yourDomain&gt;&quot;.
              </li>
              <li class="listitem">
                implementationName - the name of the implementation
                module. Has to be &quot;OpenEngSB :: Domains ::
                &lt;yourDomain&gt; :: Implementation&quot;
              </li>
            </ul>
          
          <p>
            Where &lt;yourDomain&gt; has to be replaced by your
            domain name which is usually written in lower case,
            i.e. <tt>report</tt> for the report
            domain.
          </p>
          <p>
            Note that the archetype will use the artifactId to name
            the project, but the OpenEngSB convention is to use the
            domain name. Therefore you will have to rename the
            resulting project. Do not forget to check that the new
            domain is included in the modules section of the
            domains pom.
          </p>
        
        
          
            
              
                </div><div class="title"><h3 class="title">
                  <a name="d0e3581" id="d0e3581"></a>41.2.2.&#xa0;Using
                  <tt>mvn
                  openengsb:genDomain</tt>
                <a name="a41.2.2.Using__________________mvn__________________openengsb:genDomain"></a></h3>
              
            
          
          <p>
            Simply invoke <tt>mvn
            openengsb:genDomain</tt> from the domains directory
            in your OpenEngSB repository (alternatively the <tt>etc/scripts/gen-domain.sh</tt> script
            can be used which invokes the openengsb-maven-plugin
            for you).
          </p>
          
            <p>
              <br />
              &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;<span class="command"><b>domains&#xa0;$</b></span>&#xa0;mvn&#xa0;openengsb:genDomain<br />
              &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
            </p>
          
          <p>
            You'll be asked to fill in a few variables which are
            needed to create the initial project structure. Based
            on your input, the mojo tries to guess further values.
            Guessed values are displayed in brackets. If the guess
            is correct, simply acknowledge with <tt>Return</tt>. As example, the
            following output has been recorded while creating the
            Test domain:
          </p>
          
            <p>
              <span class="command"><b>Domain&#xa0;Name&#xa0;[mydomain]:</b></span>&#xa0;test&#xa0;&lt;Enter&gt;<br />
              <span class="command"><b>Version&#xa0;[1.0.0-SNAPSHOT]:</b></span>&#xa0;&lt;Enter&gt;<br />
              <span class="command"><b>Prefix&#xa0;for&#xa0;project&#xa0;names&#xa0;[OpenEngSB&#xa0;::&#xa0;Domains&#xa0;::&#xa0;Test]:</b></span>&#xa0;&lt;Enter&gt;
            </p>
          
          <p>
            Only the domain name has been filled in, while the rest
            has been correctly guessed. After giving the inputs,
            the Maven archetype gets executed and may ask for
            further inputs. You can simply hit <tt>Return</tt>, as the values have been
            already correctly set. If the mojo finishes
            successfully two new Maven projects, the domain parent
            and domain implementation project, have been created
            and setup with a sample implementation for a domain.
          </p>
        
        
          
            
              
                </div><div class="title"><h3 class="title">
                  <a name="d0e3619" id="d0e3619"></a>41.2.3.&#xa0;Project structure
                <a name="a41.2.3.Project_structure"></a></h3>
              
            
          
          <p>
            The newly created domain should have the exact same
            structure as the following listing:
          </p>
<div class="programlisting"><pre>
-- implementation
|  -- pom.xml
|  -- src
|     -- main
|     |  -- java
|     |  -- org
|     |     -- openengsb
|     |        -- domains
|     |           -- mydomain
|     |              -- MyDomain.java
|     |              -- MyDomainEvents.java
|     |              -- MyDomainProvider.java
|     -- resources
|        -- META-INF
|        |   -- spring
|        |      -- mydomain-context.xml
|        -- OSGI-INF
|           -- l10n
|              -- bundle_de.properties
|              -- bundle.properties
-- pom.xml
</pre></div>
          <p>
            The project contains stubs for the domain interface,
            the domain events interface and the domain provider and
            a resources folder with the spring setup and property
            files for internationalization.
          </p>
          <p>
            Although the generated domain does in effect nothing,
            you can already start the OpenEngSB for testing with
            <tt>mvn clean install
            openengsb:provision</tt> and the domain will be
            automatically be picked up and started.
          </p>
          <p>
            The spring setup in the resources folder already
            contains the necessary setup for this domain to work in
            the OpenEngSB environment. Furthermore the default
            implementation proxies for the domain interface, which
            forwards all service calls to the default connector for
            the domain and the default implementation of the domain
            event interface, which forwards all events to the
            workflow service of the OpenEngSB are configured.
          </p>
          <p>
            Each OpenEngSB bundle (core, domain, connector) has
            been designed with localization in mind. The Maven
            Archetype already creates two <tt>bundle*.properties</tt> files, one
            for English (bundle.properties) and one for the German
            (bundle_de.properties) language. Each connector has to
            provide localization through it own properties files.
            For domains, this only means localization for a name
            and description of the domain itself.
          </p>
        
      
      
        
          
            
              </div></div><div class="title" style="clear: both"><h2 class="title" style="clear: both">
                <a name="d0e3640" id="d0e3640"></a>41.3.&#xa0;Components
              <a name="a41.3.Components"></a></h2>
            
          
        
        
          <ol class="orderedlist" style="list-style-type: decimal">
            <li class="listitem">
              <p>
                Domain interface - This is the interface that
                connectors of that domain must implement.
                Operations that connectors should provide, are
                specified here. Events that are raised by this
                Domain in unexpected fashion (e.g new commit in scm
                system) are specified on the Interface. The Raise
                Annotation and the array of Event classes it takes
                as an argument are used. If the Raise annotation is
                put on a method the events that are specified
                through the annotation are raised in sequence upon
                a call.
              </p>
            </li>
            <li class="listitem">
              <p>
                Domain event interface - This is the interface the
                domain provides for its connectors to send events
                into OpenEngSB. The event interface contains a
                <tt>raiseEvent(SomeEvent
                event)</tt> method for each supported event type.
              </p>
            </li>
            <li class="listitem">
              <p>
                Domain Provider - The domain provider is a service
                that provides information about the domain itself.
                It is used to determine which domains are currently
                registered in the environment. There is an abstract
                class, that takes over most of the setup.
              </p>
            </li>
            <li class="listitem">
              <p>
                Spring context - There are three services, that
                must be registered with the OSGi
                service-environment. First, there is the Domain
                Provider. Moreover, the domain must provide a kind
                of connector itself since it must be able to handle
                service calls and redirect it to the
                default-connector specified in the current context.
                And finally the domain provides an event interface
                for its connectors which can be used by them to
                send events into OpenEngSB. The default
                implementation of this event interface simply
                forwards all events sent through the domain to the
                workflow service. However, domains can also provide
                their own implementation of their event interface
                and add data to events or perform other tasks.
                There is a bean factory that creates a Java-Proxy
                that can be used as ForwardService both for the
                forwarding of service calls from domain to
                connector and for the forwarding of events to the
                workflow service. The service call to
                ForwardService looks up the default-connector for
                the specified domain in the current context and
                forwards the method-call right to it. The event
                forward service simply forwards all events to the
                workflow service of OpenEngSB.
              </p>
            </li>
          </ol>
        
      
      
        
          
            
              </div><div class="title" style="clear: both"><h2 class="title" style="clear: both">
                <a name="d0e3659" id="d0e3659"></a>41.4.&#xa0;Connectors
              <a name="a41.4.Connectors"></a></h2>
            
          
        
        <p>
          For information regarding the implementation of
          connectors for the newly created domain see <a href="developer.howto.internal.connector.html" class="xref" title="Chapter 40. How To Create an Internal Connector">Chapter&#xa0;40,
          <i>How To Create an Internal Connector</i></a>.
        </p>
      
    
    
      <hr />
      <table border="0" class="bodyTable" width="100%" summary="Navigation footer">
        <tr class="a">
          <td width="40%" align="left">
            <a href="developer.howto.internal.connector.html">Prev</a>&#xa0;
          </td>
          <td width="20%" align="center">
            <a href="openengsb-manual.html">Home</a>
          </td>
          <td width="40%" align="right">
            &#xa0;<a href="developer.wrapped.html">Next</a>
          </td>
        </tr>
        <tr class="b">
          <td width="40%" align="left" valign="top">
            Chapter&#xa0;40.&#xa0;How To Create an Internal Connector&#xa0;
          </td>
          <td width="20%" align="center">
            <span style="color:white;font-size:85%;"><a class="externalLink" href="http://openengsb.org/" title="OpenEngSB Community">OpenEngSB
            Community</a></span>
          </td>
          <td width="40%" align="right" valign="top">
            &#xa0;Chapter&#xa0;42.&#xa0;Prepare and use Non-OSGi Artifacts
          </td>
        </tr>
      </table>
    
  </div>

      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    </div>
</div>
    <div id="footer">
      <div class="xright">&#169;            2009-2011
                
                               - <a href="http://maven.apache.org/privacy-policy.html">Privacy Policy</a> <script type="text/javascript" src="http://www.ohloh.net/p/494725/widgets/project_thin_badge.js"></script></div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
