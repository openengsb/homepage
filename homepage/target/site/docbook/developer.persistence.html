<!--

    Licensed to the Austrian Association for Software Tool Integration (AASTI)
    under one or more contributor license agreements. See the NOTICE file
    distributed with this work for additional information regarding copyright
    ownership. The AASTI licenses this file to you under the Apache License,
    Version 2.0 (the "License"); you may not use this file except in compliance
    with the License. You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

-->

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia at Sep 17, 2011 -->
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>
    
    
    
      Chapter 16. Persistence in the OpenEngSB
    </title>
    <style type="text/css" media="all">
      @import url("../css/maven-base.css");
      @import url("../css/maven-theme.css");
      @import url("../css/site.css");

            
      <!--[if IE]>
      @import url("../css/site-ie-fixes.css");
      <![endif]-->
    </style>

        <!--[if IE]><link rel="stylesheet" href="../css/site-ie-fixes.css" type="text/css" media="all" /><![endif]-->
    <link rel="icon" type="image/x-icon" href="../images/openengsb.ico" />
    <link rel="shortcut icon" type="image/x-icon" href="../images/openengsb.ico" />
    <link rel="stylesheet" href="../css/print.css" type="text/css" media="print" />
        <meta name="Date-Revision-yyyymmdd" content="20110917" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
                                                    
<script type="text/javascript">var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-17453231-1']);
        _gaq.push(['_trackPageview']);

        (function() {
          var ga = document.createElement('script'); ga.type =
          'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' :
          'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0];
          s.parentNode.insertBefore(ga, s);
        })();</script>
                    </head>
  <body class="composite">
<div id="header">
    <div id="banner">
                  <span id="bannerLeft">
                                                <img src="../images/openengsb_small.png" alt="" />
                </span>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
                                        <div class="xleft">
        Last Published: 2011-09-17
                  &nbsp;| Version: 2.0.0-SNAPSHOT "Qualified Q"
                      </div>
            <div class="xright">            <a href="http://openengsb.org/" class="externalLink" target="_blank">Final Release</a>
            |
                <a href="http://openengsb.org/milestone" class="externalLink" target="_blank">Milestone Release</a>
            |
                <a href="http://openengsb.org/nightly" class="externalLink" target="_blank">Nightly Release</a>
              
                              </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
</div>   
<div id="body">
	<div id="content">
    <div id="leftColumn">
      <div id="navcolumn">
             
                                                        <div class="menuItem"><h5>OpenEngSB</h5></div>
                  <ul>
                  <li class="none">
                  <a href="../index.html">Welcome</a>
            </li>
                  <li class="none">
                  <a href="../about.html">What is OpenEngSB?</a>
            </li>
                  <li class="none">
                  <a href="../downloads.html">Downloads</a>
            </li>
                  <li class="none">
                  <a href="https://github.com/openengsb/openengsb/raw/master/CHANGELOG.md" class="externalLink" target="_blank">Changelog</a>
            </li>
                  <li class="none">
                  <a href="https://github.com/openengsb/openengsb/blob/master/KNOWN_ISSUES.md" class="externalLink" target="_blank">Known Issues</a>
            </li>
                  <li class="none">
                  <a href="../sponsors.html">Sponsors</a>
            </li>
                  <li class="none">
                  <a href="../subprojects.html">Subprojects</a>
            </li>
          </ul>
                       <div class="menuItem"><h5>Quickstart</h5></div>
                  <ul>
                  <li class="none">
                  <a href="../docbook/howto.setup.html">Installation</a>
            </li>
                  <li class="none">
                  <a href="../docbook/howto.logging.html">Connectors and Domains</a>
            </li>
                  <li class="none">
                  <a href="../docbook/howto.contexteditor.html">Events</a>
            </li>
          </ul>
                       <div class="menuItem"><h5>Documentation</h5></div>
                  <ul>
                  <li class="none">
                  <a href="../manual/index.html">Manual</a>
            </li>
                  <li class="none">
                  <a href="../reference/faq.html">FAQ</a>
            </li>
                  <li class="none">
                  <a href="../reference/additional.html">Articles</a>
            </li>
                  <li class="none">
                  <a href="http://www.youtube.com/user/cdflexvideo" class="externalLink" target="_blank">Youtube Channel</a>
            </li>
          </ul>
                       <div class="menuItem"><h5>Community</h5></div>
                  <ul>
                  <li class="none">
                  <a href="../community/mailinglists.html">Mailing Lists</a>
            </li>
                  <li class="none">
                  <a href="../community/irc.html">IRC Channels</a>
            </li>
                  <li class="none">
                  <a href="http://twitter.com/openEngSB" class="externalLink" target="_blank">Twitter</a>
            </li>
                  <li class="none">
                  <a href="http://www.facebook.com/group.php?gid=208312030232" class="externalLink" target="_blank">Facebook</a>
            </li>
          </ul>
                       <div class="menuItem"><h5>Development</h5></div>
                  <ul>
                  <li class="none">
                  <a href="../contribution.html">Contribution</a>
            </li>
                  <li class="none">
                  <a href="../source-repository.html">Source</a>
            </li>
                  <li class="none">
                  <a href="../issue-tracking.html">Issues</a>
            </li>
                  <li class="none">
                  <a href="../integration.html">CI</a>
            </li>
                  <li class="none">
                  <a href="../team-list.html">Team</a>
            </li>
          </ul>
                   
                                    </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        
  
  
    
      
      
    
    
      
        
          
            <div class="title"><h2 class="title">
              <a name="developer.persistence" id="developer.persistence"></a>Chapter&#xa0;16.&#xa0;Persistence
              in the OpenEngSB
            <a name="Chapter16.Persistence______________in_the_OpenEngSB"></a></h2>
          
        
      
      <p>
        The OpenEngSB contains various different persistence
        solutions which should be introduced and explained in this
        chapter
      </p>
      
        
          
            
              </div><div class="title" style="clear: both"><h2 class="title" style="clear: both">
                <a name="d0e1545" id="d0e1545"></a>16.1.&#xa0;Core
                Persistence
              <a name="a16.1.Core________________Persistence"></a></h2>
            
          
        
        <p>
          The OpenEngSB has a central persistence service, which
          can be used by any component within in the OpenEngSB to
          store data. The service is designed for flexibility and
          usability for the storage of relatively small amounts of
          data with no explicit performance requirements. If
          special persistence features need to be used it is
          recommended to use a specialized storage rather than the
          general storage mechanism.
        </p>
        <p>
          The persistence service can store any Java Object, but
          was specifically designed for Java Beans.
        </p>
        <p>
          The interface of the <a class="link" href="https://github.com/openengsb/openengsb/blob/master/core/api/src/main/java/org/openengsb/core/api/persistence/PersistenceService.java" target="_top">persistence service</a> supports basic
          CRUD (create, update, retrieve, delete) mechanisms.
          Instances of the persistence service are created per
          bundle and have to make sure that data is stored
          persistently. If bundles need to share data the common
          persistence service cannot be used, as it does not
          support this feature. The <a class="link" href="https://github.com/openengsb/openengsb/blob/master/core/api/src/main/java/org/openengsb/core/api/persistence/PersistenceManager.java" target="_top">persistence manager</a> is responsible for
          the management of persistence service instances per
          bundle. On the first request from a bundle the
          persistence manager creates a persistence service. All
          later requests from a specific bundle should get the
          exact same instance of the persistence service.
        </p>
        <p>
          Queries with the OpenEngSB persistence done via the <a class="link" href="https://github.com/openengsb/openengsb/blob/master/core/api/src/main/java/org/openengsb/core/api/persistence/PersistenceService.java" target="_top">persistence service</a>. Behind this
          service an easy query-by-example logic is used to
          retrieve your results. In some cases the comparision and
          storage can create some wired problems for your specific
          use cases. For those cases the <a class="link" href="https://github.com/openengsb/openengsb/blob/master/core/api/src/main/java/org/openengsb/core/api/persistence/IgnoreInQueries.java" target="_top">IgnoreInQueries</a> annotation had been
          added. Using this annotation on getters in classes
          persisted via the <a class="link" href="https://github.com/openengsb/openengsb/blob/master/core/api/src/main/java/org/openengsb/core/api/persistence/PersistenceService.java" target="_top">persistence service</a> querying them
          ignores those fields during trying to compare them to
          stored data.
        </p>
        <p>
          The persistence solution of the OpenEngSB was designed to
          support different possible back-end database systems. So
          if a project has high performance or security
          requirements, which can not be fulfilled with the default
          database system used by the persistence service, it is
          possible to implement a different persistence back-end.
          To make this exchange easier a <a class="link" href="https://github.com/openengsb/openengsb/blob/master/core/persistence/src/test/java/org/openengsb/core/persistence/PersistenceServiceTest.java" target="_top">test</a> for the expected behavior of the
          persistence service is provided.
        </p>
      
      
        
          
            
              </div><div class="title" style="clear: both"><h2 class="title" style="clear: both">
                <a name="d0e1576" id="d0e1576"></a>16.2.&#xa0;Configuration Persistence
              <a name="a16.2.Configuration_Persistence"></a></h2>
            
          
        
        <p>
          Besides the centralized Java Bean store the OpenEngSB
          also have a more specialized solution to store
          configurations. Configurations are basically also Java
          Beans, but have to extend a <a class="link" href="https://github.com/openengsb/openengsb/blob/master/core/api/src/main/java/org/openengsb/core/api/model/ConfigItem.java" target="_top">ConfigItem</a>. Well, since Configurations
          are also only Java Beans you may ask: Why not simply
          store them via the <a class="link" href="https://github.com/openengsb/openengsb/blob/master/core/api/src/main/java/org/openengsb/core/api/persistence/PersistenceService.java" target="_top">persistence service</a>? The reason is
          quite simple. We do need to store configurations at
          various places. Options may be the file system, an object
          store or any other place. In addition configurations,
          when you e.g. store them to files, have to be quite
          specific about their types. Rule, for example, have to be
          stored as simple strings, flows as xml files and
          connectors as key-value-pairs. Beeing so specific the
          implementations of the backends also have to be specific.
          Besides, there are kind of regions. Examples are Rules,
          Flows, and various others. Bascially in you code you
          simply want to ask for a configuration persister for
          rules and do not care if it is a file persister or
          something else. In addition rules could be persisted
          somewhere else than e.g. flows. Therefore those backends
          have to be configured separate for each type.
        </p>
        <p>
          Ok, after the need is identified let's take a look at the
          how. Basically it's quite simple. You register various
          backend services in the OSGi registry, give them a
          specific ID, configure how a region is mapped to an idea
          and request a persister for a specific region or type and
          retrieve the correct implementation. From a user point of
          view this system is quite simple. Use the
          getConfigPersistenceService(String type) method from the
          <a class="link" href="https://github.com/openengsb/openengsb/blob/master/core/common/src/main/java/org/openengsb/core/common/OpenEngSBCoreServices.java" target="_top">OpenEngSBCoreServices</a> class with the
          type, which is typically stored directly at the
          configurations, as for example for the <a class="link" href="https://github.com/openengsb/openengsb/blob/master/core/api/src/main/java/org/openengsb/core/api/model/RuleConfiguration.java" target="_top">RuleConfiguration</a> and retrieve and
          persist RuleConfigurations. The mapping between the
          backend and the frontend is defined in the configuration
          file <a class="link" href="https://github.com/openengsb/openengsb/blob/master/assembly/src/main/filtered-resources/etc/org.openengsb.persistence.config-rule.cfg" target="_top">here</a>. If you want to use another
          available and compatible backend for rule configurations
          add the backend id in the configuration file and the
          service for this region will switch automatically.
        </p>
        <p>
          Although it is quite simple to configure, change and
          consume and provide provide configurations it is mostly
          not a good idea to simply change the properties, backend
          or frontend if you're not exactly sure about what you're
          doing. You can easily take the wrong backend service
          which will not be able to persist e.g. a
          RuleConfiguration and throws exceptions. If you swtich
          the backend during the run everything stored in the old
          backend would not be avialable in the new one. Within a
          client project mostly relay on using those services to
          read the properties and use the OpenEngSB to store them.
        </p>
        <p>
          Still the system can easily be extended to your own use.
          Typically you have to do the following steps to provide a
          new configuration service. First of all start by
          providing an own Configuration which extends <a class="link" href="https://github.com/openengsb/openengsb/blob/master/core/api/src/main/java/org/openengsb/core/api/model/ConfigItem.java" target="_top">ConfigItem</a>. Please only use the
          metadata and content fields and do not add additional
          variables. They wont get stored. Now add a configuration
          file into etc with
          org.openengsb.persistence.config-ANY_NAME_YOU_LIKE.cfg.
          In this file define the region and the backend id. The
          exact values and detailed explanation for those fields is
          available <a class="link" href="https://github.com/openengsb/openengsb/blob/master/core/api/src/main/java/org/openengsb/core/api/Constants.java" target="_top">here</a>. If you've not choosen one of the
          general available services for storage you now can
          implement your own backend service registered in the OSGi
          registry with the ID you've configured in the .cfg file
          before. The interface you have to implement and register
          as a service is the <a class="link" href="https://github.com/openengsb/openengsb/blob/master/core/api/src/main/java/org/openengsb/core/api/persistence/ConfigPersistenceBackendService.java" target="_top">ConfigPersistenceBackendService</a>.
        </p>
        
          
            
              
                <div class="title"><h3 class="title">
                  <a name="d0e1611" id="d0e1611"></a>16.2.1.&#xa0;Context configuration
                  persistence
                <a name="a16.2.1.Context_configuration__________________persistence"></a></h3>
              
            
          
          <p>
            The context configuration persistence follows the basic
            congiguation persistence scheme. In this case the
            backend (<a class="link" href="https://github.com/openengsb/openengsb/blob/master/core/services/src/main/java/org/openengsb/core/services/internal/ContextFilePersistenceService.java" target="_top">ContextFilePersistenceService</a>)
            creates files for each context (basically empty files
            with filename &lt;contextId&gt;.context), the context
            service (<a class="link" href="https://github.com/openengsb/openengsb/blob/master/core/services/src/main/java/org/openengsb/core/services/internal/ContextServiceImpl.java" target="_top">ContexServiceImpl</a>) requests a config
            persistcene service of type CONTEXT, is given the
            aforementioned one and uses it to persist its data.
          </p>
        
      
    
    
      <hr />
      <table border="0" class="bodyTable" width="100%" summary="Navigation footer">
        <tr class="a">
          <td width="40%" align="left">
            <a href="developer.context.html">Prev</a>&#xa0;
          </td>
          <td width="20%" align="center">
            <a href="openengsb-manual.html">Home</a>
          </td>
          <td width="40%" align="right">
            &#xa0;<a href="developer.management.html">Next</a>
          </td>
        </tr>
        <tr class="b">
          <td width="40%" align="left" valign="top">
            Chapter&#xa0;15.&#xa0;Context Management&#xa0;
          </td>
          <td width="20%" align="center">
            <span style="color:white;font-size:85%;"><a class="externalLink" href="http://openengsb.org/" title="OpenEngSB Community">OpenEngSB
            Community</a></span>
          </td>
          <td width="40%" align="right" valign="top">
            &#xa0;Chapter&#xa0;17.&#xa0;Security in the OpenEngSB
          </td>
        </tr>
      </table>
    
  </div></div>

      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    </div>
</div>
    <div id="footer">
      <div class="xright">&#169;            2009-2011
                
                               - <a href="http://maven.apache.org/privacy-policy.html">Privacy Policy</a> <script type="text/javascript" src="http://www.ohloh.net/p/494725/widgets/project_thin_badge.js"></script></div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
